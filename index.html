<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MatchaTone — state videos</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/addons/p5.sound.min.js"></script>
</head>
<body>
  <div id="app">
    <div id="loading">Loading…</div>

    <button id="startBtn">Start</button>

    <div id="stage"></div>

    <div id="hud">
      <span id="stateTxt">state: live</span>
      <span id="micTxt">mic: idle</span>
      <span id="lvlTxt">level: 0.000</span>
      <span id="dbTxt">~ dB: -∞</span>
    </div>

    <!-- Controls for testers -->
    <div id="panel">
      <button id="calBtn">Calibrate 2s</button>
      <button id="muteBtn">Mute Mic</button>  <!-- 新增：闭麦按钮 -->

      <label> Sensitivity
        <input id="sens" type="range" min="0.05" max="4" value="1" step="0.05"> <!-- 调低最小值 -->
      </label>
      <label> Soft TH
        <input id="softTH" type="range" min="0.001" max="0.1" value="0.02" step="0.001">
      </label>
      <label> Loud TH
        <input id="loudTH" type="range" min="0.05" max="0.5" value="0.12" step="0.01">
      </label>
      <div id="meterWrap">
        <div id="meterBar"></div>
      </div>
      <div id="tips">
        Tip: If level stays at 0, check browser mic permission or click Start again.
      </div>
      <label> Mic
        <select id="micSelect"></select>
      </label>
      <button id="refreshBtn">Refresh</button>
    </div>

    <details id="guide" open>
      <summary>How to Test</summary>
      <ol>
        <li>Click <b>Start</b> and allow microphone access.</li>
        <li>Tap the stage once → <b>Happy</b> for 1.2 s.</li>
        <li>Clap or make a loud sound → <b>Shy</b> for 1.2 s.</li>
        <li>Stay quiet or do nothing for 30 s → <b>Sleep</b> mode.</li>
        <li>Speak or hum softly → stays in <b>Live</b> (awake).</li>
      </ol>
      <p><b>Troubleshooting</b></p>
      <ul>
        <li>If nothing happens, check microphone permission in your browser.</li>
        <li>Make sure the correct input device is selected in system settings.</li>
        <li>Too much background noise may trigger <b>Shy</b> too often.</li>
        <li>On mobile, keep videos muted for stable autoplay.</li>
      </ul>
    </details>
  </div>
  <script src="sketch.js"></script>
</body>
</html>
